<!DOCTYPE html>
<html>
  <head>
    <title>iPong</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../assets/styles/styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="../../assets/icons/logo2.svg" type="image/svg+xml">
  </head>

  <body class="bg-gray-100 text-gray-800">

    <!-- Top Navigation Bar -->
    <nav id="navbar" class="fixed top-0 left-0 right-0 z-50 navbar-transition">
      <div class="container mx-auto px-4 py-3 flex justify-between items-center">
        <!-- Title on the Left -->
        <h1 class="text-2xl font-bold navbar-text px-5 py-1 flex-1"><a href="../../">iPong</a></h1>
  
        <!-- Buttons on the Right -->
        <div class="hidden lg:flex space-x-6 px-5 py-1">
          <a href="../../design" class="navbar-link font-semibold hover:underline decoration-2 underline-offset-4">Design</a>
          <button id="dropdownHoverButton" data-dropdown-toggle="dropdownHover" data-dropdown-trigger="hover" 
            class="navbar-link flex font-semibold hover:underline decoration-2 underline-offset-4" type="button">
            <a href="../../implementation/">Implementation</a>
            <svg class="-mr-1 size-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
              <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
            </svg>
          </button>
          <!-- Dropdown menu -->
          <div id="dropdownHover" class="mt-2 hidden bg-white shadow-lg rounded-lg py-2 w-48">
            <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownHoverButton">
              <li><a href="../../implementation/vision/" class="block px-4 py-2 font-semibold text-gray-700 hover:bg-gray-100 hover:text-gray-900">Vision</a></li>
              <li><a href="../../implementation/trajectory/" class="block px-4 py-2 font-semibold text-gray-700 hover:bg-gray-100 hover:text-gray-900">Trajectory</a></li>
              <li><a href="../../implementation/control/" class="block px-4 py-2 font-semibold text-gray-700 hover:bg-gray-100 hover:text-gray-900">Control</a></li>
            </ul>
          </div>
          <a href="../../results" class="navbar-link font-semibold hover:underline decoration-2 underline-offset-4">Results</a>
          <a href="../../conclusion" class="navbar-link font-semibold hover:underline decoration-2 underline-offset-4">Conclusion</a>
          <a href="../../team" class="navbar-link font-semibold hover:underline decoration-2 underline-offset-4">Team</a>
          <a href="../../resources" class="navbar-link font-semibold hover:underline decoration-2 underline-offset-4">Resources</a>
        </div>
  
        <!-- Mobile Menu Button -->
        <button id="dropdownDefaultButton" data-dropdown-toggle="mobileMenu" 
          data-dropdown-offset-distance="20"
          class="lg:hidden navbar-link" type="button">
          <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          </button>
      </div>
    </nav>
  
    <!-- Mobile Menu -->
    <div id="mobileMenu" class="lg:hidden z-20 hidden bg-gray-400 shadow-lg rounded-lg py-2  px-20 w-full absolute top-full left-0">
      <ul class="py-2 text-gray-700 dark:text-gray-200" aria-labelledby="dropdownDefaultButton">
        <li><a href="../../design" class="block px-4 py-2 navbar-link font-semibold hover:bg-gray-100 hover:text-gray-900">Design</a></li>
        <li><a href="../../implementation" class="block px-4 py-2 navbar-link font-semibold hover:bg-gray-100 hover:text-gray-900">Implementation</a></li>
        <li><a href="../../results" class="block px-4 py-2 navbar-link font-semibold hover:bg-gray-100 hover:text-gray-900">Results</a></li>
        <li><a href="../../conclusion" class="block px-4 py-2 navbar-link font-semibold underline-offset-4 hover:bg-gray-100 hover:text-gray-900">Conclusion</a></li>
        <li><a href="../../team" class="block px-4 py-2 navbar-link font-semibold  hover:bg-gray-100 hover:text-gray-900">Team</a></li>
        <li><a href="../../resources" class="block px-4 py-2 navbar-link font-semibold hover:bg-gray-100 hover:text-gray-900">Resources</a></li>
      </ul>
    </div>

    <!-- Hero Section -->
    <section class="relative bg-gray-900 h-[400px] flex items-center justify-center">
      <img src="../../assets/images/implementation.jpg" 
          alt="Hero Image" 
          class="absolute inset-0 w-full h-full object-cover opacity-50">
      <div class="text-center relative z-10">
        <h1 class="text-5xl font-bold text-white drop-shadow-lg">Implementation: Vision</h1>
      </div>
    </section>

    <!-- Overview -->
    <section id="overview" class="py-20 bg-white">
      <div class="container mx-auto px-4 text-center">
        <h2 class="text-4xl font-bold text-gray-800 mb-6">Overview</h2>
        <p class="text-gray-600 max-w-4xl mx-auto text-left leading-relaxed mb-8">
          The purpose of vision in this project is to obtain the 3D ball position in the robot frame. The implementation to obtain the 
          ball position from cameras is shown in the diagram below. 
        </p>
        <div class="mt-16">
          <img 
            src="../../assets/images/vision_diagram.jpg" 
            alt="System Diagram" 
            class="rounded-lg w-full max-w-4xl mx-auto"
          />
        </div>
      </div>
    </section>

    <!-- 3D Ball Coordinate Camera Frame -->
    <section id="applications" class="py-16 bg-gray-50">
      <div class="container mx-auto px-4 max-w-6xl">
        <!-- Grid Layout -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-12 items-center md:items-start">
          <!-- Text Content -->
          <div class="md:col-span-2">
            <h2 class="text-3xl font-bold mb-8">Locating Ball in Camera Frame</h2>
            <p class="text-gray-600 leading-relaxed">
              <b>Accessing RealSense Camera Stream: </b>
              We use the <mark>realsense2_camera</mark> package, which broadcasts the RGB and depth video streams to 2 separate topics for access.
              With a video stream of 30 FPS, we obtain new ball coordinates at the same rate, which is roughly 0.03s between updates.
              <br /><br />
              <b>HSV Thresholding: </b>
              We first obtain optimal HSV filtering thresholds by manual tuning until we can only see points in the image associated with the ball 
              remaining after the thresholding process. Given the RGB image from RealSense, we then first perform HSV thresholding so that only points 
              of the ball remain, and then derive the 2D ball coordinate in the image by averaging the coordinates of these points.
              <br /><br />
              <b>DBSCAN Clustering: </b>
              Since averaging is used to obtain the 2D ball coordinate in the image, which is highly susceptible to noise (outliers), 
              we utilize a popular clustering technique to first locate the largest cluster in all the points that passed through the HSV thresholding,
              and then remove any points that are outside of the main cluster. This leads to overall greater robustness against background noises in the image.
              <br /><br />
              <b>Depth Thresholding: </b>
              Since the RealSense Camera we used is only accurate up to 3 meters, we further eliminate background noise by removing any points with a depth above 
              3 meters. This helps remove the influence of objects further in the background that are not useful for ball detection.
              <br /><br />
              <b>3D Ball Coordinate: </b>
              Using the 2D ball coordinate derived from HSV thresholding, we can use the depth image to look up the depth of the ball, and obtain the full 
              3D ball coordinate in the camera frame.
            </p>
          </div>
          <!-- Image Section -->
          <div class="md:place-self-center">
            <img src="../../assets/images/vision.jpg" 
                 alt="Vision Section Image" 
                 class="rounded-lg w-full max-h-96 object-cover shadow-md">
          </div>
        </div>
      </div>
    </section>

    <!-- Camera Position with AR Tracking -->
    <section id="applications" class="py-16 bg-white">
      <div class="container mx-auto px-4 max-w-6xl">
        <div class="grid grid-cols-3 gap-12 items-center">
          <div>
            <img src="../../assets/images/locate_cam.jpeg" 
                alt="Application Section Image" 
                class="rounded-lg">
            <img src="../../assets/images/ar_tag.png" 
                alt="Application Section Image" 
                class="rounded-lg">
          </div>
          <div class="col-span-2">
            <h2 class="text-3xl font-bold mb-4">Locating Camera with AR Tracking</h2>
            <p class="text-gray-600 leading-relaxed">
              We attach the AR tag to the back of the RealSense camera, which is in view of the Sawyer robot head camera. We use the 
              <mark>intera_examples</mark> package from Rethink to turn on the Sawyer head camera, which broadcasts the video stream to a topic. <br /><br />
              We then use the ROS <mark>ar_track_alvar</mark> package to automatically detect AR tags in view of the Saywer head camera and 
              broadcast the 3D coordinate of the AR tag to a topic for access. With this setup, we can obtain the position of the RealSense camera 
              in the robot frame.
            </p>
          </div>
        </div>
      </div>
    </section> 

    <!-- 3D Ball Coordinate in Robot Frame -->
    <section id="applications" class="py-16 bg-white-gray">
      <div class="container mx-auto px-4 max-w-6xl">
        <div class="grid grid-cols-3 gap-12 items-center">
          <div class="col-span-2">
            <h2 class="text-3xl font-bold mb-4">Obtaining Ball Coordinate in Robot Frame</h2>
            <p class="text-gray-600 leading-relaxed">
              To perform frame transform for the 3D ball coordinate from camera frame to the robot frame, we utilize the ROS <mark>tf</mark> package.
              We first initialize a static transform publisher to link the camera nodes and sawyer nodes, which are from two separate trees. We then 
              use the <mark>tf.TransformListener</mark> to convert the ball coordinate at each frame.
            </p>
          </div>
          <div>
            <img src="../../assets/images/frame_trans.png" 
                alt="Application Section Image" 
                class="rounded-lg">
          </div>
        </div>
      </div>
    </section> 

    <!-- Footer -->
    <footer id="resources" class="bg-gray-900 text-white py-8">
      <div class="container mx-auto px-4 text-center">
        <p class="text-gray-400">&copy; EECS/ME 206A Team 8, Fall 2024, UC Berkeley</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>
    <script src="../../assets/js/animte_trans_nav.js"></script>
    <script src="../../assets/js/mobile_menu_toggle.js"></script>
  </body>
</html>